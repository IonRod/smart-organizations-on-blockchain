<!DOCTYPE html>
<html>
	<head>
		<title>DAO</title>
		<script src="./web3.min.js"></script>
	</head>
	<body>
		<div>
			<input id="input"  type="text" >
			<button id="button">Set</button>
		</div>
		<div>
			<button id="buttonGet">Get</button>
			<pre id="output"/>
		</div>
			
		

		<script type="text/javascript">
			
			var web3 = new Web3(new Web3.providers.HttpProvider("http://10.15.42.168:8545"));
			web3.eth.defaultAccount = web3.eth.accounts[0];
			//abi - application binary interface (похоже на JSON)
			var Tasks = web3.eth.contract([
		    {
		      "constant": false,
		      "inputs": [
		        {
		          "name": "_description",
		          "type": "string"
		        }
		      ],
		      "name": "createTask",
		      "outputs": [],
		      "payable": false,
		      "stateMutability": "nonpayable",
		      "type": "function"
		    },
		    {
		      "constant": true,
		      "inputs": [
		        {
		          "name": "_taskNumber",
		          "type": "uint256"
		        }
		      ],
		      "name": "taskInformation",
		      "outputs": [
		        {
		          "name": "",
		          "type": "uint256"
		        },
		        {
		          "name": "",
		          "type": "string"
		        }
		      ],
		      "payable": false,
		      "stateMutability": "view",
		      "type": "function"
		    },
		    {
		      "constant": false,
		      "inputs": [
		        {
		          "name": "_taskNumber",
		          "type": "uint256"
		        },
		        {
		          "name": "_decision",
		          "type": "bool"
		        }
		      ],
		      "name": "Vote",
		      "outputs": [],
		      "payable": false,
		      "stateMutability": "nonpayable",
		      "type": "function"
		    },
		    {
		      "constant": true,
		      "inputs": [],
		      "name": "taskQuantity",
		      "outputs": [
		        {
		          "name": "",
		          "type": "uint256"
		        }
		      ],
		      "payable": false,
		      "stateMutability": "view",
		      "type": "function"
		    }
		  ]).at('0x36a5fc4620fb37e8d5b7d559a9e248b714336daf'); // публикует контракт от имени адреса
			

			var input = document.getElementById("input");
			var button = document.getElementById('button');
			var buttonGet = document.getElementById('buttonGet');
			var output = document.getElementById('output');
			
			button.addEventListener('click', function(){
				Tasks.createTask(input.value, function(err, res) {
					console.log('Create task output');
					console.log(err);
					console.log(res);
				});
			});
			
			
			buttonGet.addEventListener('click', function(){
				Tasks.taskQuantity.call(function(err, res) {
					
					Tasks.taskInformation.call(res-1, function(err, res) {
						output.innerHTML = res
					});
				});
				/*foo.getStroka.call().then(function(stroka){
				    console.log("s=%d", stroka);
				});*/
			});
			
		</script>

	</body>
</html>